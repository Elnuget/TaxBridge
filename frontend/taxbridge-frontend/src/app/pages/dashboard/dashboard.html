<!-- Dashboard de TaxBridge -->
<div class="dashboard">
  <c-container>
    <!-- Credentials Alert (mostrar solo la primera vez) -->
    @if (showCredentials && temporaryPassword) {
      <div class="credentials-alert">
        <c-card class="credentials-card">
          <c-card-header class="credentials-header">
            <h4>üéâ ¬°Tu cuenta ha sido creada exitosamente!</h4>
          </c-card-header>
          <c-card-body>
            <div class="credentials-info">
              <h5>üìã Tus credenciales de acceso:</h5>
              <div class="credential-item">
                <strong>üìß Email:</strong>
                <span class="credential-value">{{ customerEmail }}</span>
              </div>
              <div class="credential-item">
                <strong>üîë Contrase√±a Temporal:</strong>
                <span class="credential-value password">{{ temporaryPassword }}</span>
              </div>
              <div class="credential-note">
                <p>‚ö†Ô∏è <strong>IMPORTANTE:</strong> Guarda esta informaci√≥n en un lugar seguro.</p>
                <p>Puedes iniciar sesi√≥n con tu email y esta contrase√±a temporal.</p>
                <p>Te recomendamos cambiar tu contrase√±a despu√©s de iniciar sesi√≥n.</p>
              </div>
              <button cButton color="primary" (click)="hideCredentials()">
                Entendido, cerrar este mensaje
              </button>
            </div>
          </c-card-body>
        </c-card>
      </div>
    }

    <!-- Loading State -->
    @if (loading) {
      <div class="loading-state">
        <h3>Cargando informaci√≥n...</h3>
      </div>
    }

    <!-- Error State -->
    @if (error && !loading) {
      <div class="error-state">
        <h3>‚ùå {{ error }}</h3>
        <p>Por favor verifica tu n√∫mero de cliente</p>
      </div>
    }

    <!-- Customer Dashboard -->
    @if (customer && !loading) {
      <!-- Header del Dashboard -->
      <div class="dashboard-header mb-4">
        <h1 class="h2 mb-0">¬°Bienvenido, {{ customer.fullName }}!</h1>
        <p class="text-muted">N√∫mero de Cliente: <strong>{{ customer.customerNumber }}</strong></p>
      </div>

      <!-- Tarjetas de resumen -->
      <c-row class="mb-4">
        <c-col md="4">
          <c-card class="summary-card">
            <c-card-body>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h4 class="card-title mb-0">{{ customer.purchasedProducts.length }}</h4>
                  <p class="text-muted small">Productos Adquiridos</p>
                </div>
                <div class="icon-container bg-primary">
                  üì¶
                </div>
              </div>
            </c-card-body>
          </c-card>
        </c-col>

        <c-col md="4">
          <c-card class="summary-card">
            <c-card-body>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h4 class="card-title mb-0">${{ customer.totalPurchases.toFixed(2) }}</h4>
                  <p class="text-muted small">Total Invertido</p>
                </div>
                <div class="icon-container bg-success">
                  üí∞
                </div>
              </div>
            </c-card-body>
          </c-card>
        </c-col>

        <c-col md="4">
          <c-card class="summary-card">
            <c-card-body>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h4 class="card-title mb-0">{{ getPaymentMethodName(customer.paymentMethod) }}</h4>
                  <p class="text-muted small">M√©todo de Pago</p>
                </div>
                <div class="icon-container bg-info">
                  üí≥
                </div>
              </div>
            </c-card-body>
          </c-card>
        </c-col>
      </c-row>

      <!-- Productos Adquiridos -->
      <c-row>
        <c-col cols="12">
          <c-card>
            <c-card-header>
              <h5 class="mb-0">üìã Mis Productos</h5>
            </c-card-header>
            <c-card-body>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Producto</th>
                      <th>Categor√≠a</th>
                      <th>Cantidad</th>
                      <th>Precio Unitario</th>
                      <th>Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (product of customer.purchasedProducts; track product.productId) {
                      <tr>
                        <td><strong>{{ product.productName }}</strong></td>
                        <td>
                          <c-badge [color]="getCategoryColor(product.category)">
                            {{ getCategoryName(product.category) }}
                          </c-badge>
                        </td>
                        <td>{{ product.quantity }}</td>
                        <td>${{ product.unitPrice.toFixed(2) }}</td>
                        <td><strong>${{ product.totalPrice.toFixed(2) }}</strong></td>
                      </tr>
                    }
                  </tbody>
                  <tfoot>
                    <tr class="table-active">
                      <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                      <td><strong>${{ (customer.totalPurchases / 1.12).toFixed(2) }}</strong></td>
                    </tr>
                    <tr class="table-active">
                      <td colspan="4" class="text-end"><strong>IVA (12%):</strong></td>
                      <td><strong>${{ (customer.totalPurchases - (customer.totalPurchases / 1.12)).toFixed(2) }}</strong></td>
                    </tr>
                    <tr class="table-primary">
                      <td colspan="4" class="text-end"><strong>TOTAL:</strong></td>
                      <td><strong>${{ customer.totalPurchases.toFixed(2) }}</strong></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </c-card-body>
          </c-card>
        </c-col>
      </c-row>

      <!-- Informaci√≥n del Cliente -->
      <c-row class="mt-4">
        <c-col md="6">
          <c-card>
            <c-card-header>
              <h5 class="mb-0">üë§ Informaci√≥n Personal</h5>
            </c-card-header>
            <c-card-body>
              <div class="info-row">
                <strong>Nombre:</strong> {{ customer.fullName }}
              </div>
              <div class="info-row">
                <strong>Email:</strong> {{ customer.email }}
              </div>
              <div class="info-row">
                <strong>Tel√©fono:</strong> {{ customer.phone }}
              </div>
              <div class="info-row">
                <strong>C√©dula/RUC:</strong> {{ customer.identification }}
              </div>
            </c-card-body>
          </c-card>
        </c-col>

        <c-col md="6">
          <c-card>
            <c-card-header>
              <h5 class="mb-0">üìä Detalles de Compra</h5>
            </c-card-header>
            <c-card-body>
              <div class="info-row">
                <strong>Fecha de compra:</strong> {{ customer.lastPurchaseDate | date:'dd/MM/yyyy HH:mm' }}
              </div>
              <div class="info-row">
                <strong>Estado:</strong> 
                <c-badge [color]="customer.status === 'active' ? 'success' : 'secondary'">
                  {{ customer.status === 'active' ? 'Activo' : 'Inactivo' }}
                </c-badge>
              </div>
              <div class="info-row">
                <strong>M√©todo de Pago:</strong> {{ getPaymentMethodName(customer.paymentMethod) }}
              </div>
            </c-card-body>
          </c-card>
        </c-col>
      </c-row>
    }
  </c-container>
</div>